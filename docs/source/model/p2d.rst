Dimensional model
==================

We use the well-known P2D model described by :cite:t:`Doyle1993`. As each domain is normalized with its thickness, the gradients that we use are:

.. math::

    \begin{gathered}
                \hat{\nabla} = \begin{pmatrix} \frac{\partial}{\partial x} \\ \frac{\partial}{\partial y} \\ \frac{\partial}{\partial z} \end{pmatrix} = \begin{pmatrix} \frac{1}{L_i} \frac{\partial}{\partial x} \\ \frac{1}{H_i} \frac{\partial}{\partial y} \\ \frac{1}{W_i} \frac{\partial}{\partial z} \end{pmatrix}
    \end{gathered}

Where :math:`L_i`, :math:`H_i` and :math:`W_i` are the domain thickness, height and width. However, for a P2D model, only the first row of the vector is used.

.. rubric:: Electrochemical Model


* Mass transport in the electrolyte
    The mass transport in the electrolyte is calculated in :func:`c_e_equation <cideMOD.models.electrochemical.equations.c_e_equation>` function.
    
    .. math::

        \begin{gathered}
            \epsilon \frac{\partial c_e}{\partial t} =
            \hat{\nabla} \left( D_{eff} \hat{\nabla} c_e \right) + \frac{1}{F}\sum_{i=0}^{n_{mat}} a_i j_{i}
        \end{gathered}

* Charge transport in the electrolyte
    The charge transport in the electrolyte is calculated in :func:`phi_e_equation <cideMOD.models.electrochemical.equations.phi_e_equation>` function.

    .. math::

        \begin{gathered}
            - \hat{\nabla} \left( \kappa_{eff} \hat{\nabla} \varphi_e  - 2 \kappa_{eff} \frac{RT}{F} (1-t_0) \left(1+\frac{\partial \ln{f_{\pm}}}{\partial \ln{c_e}}\right) \hat{\nabla} \ln{c_e}  \right) = \sum_{i=0}^{n_{mat}} a_i j_{i}
        \end{gathered}

* Charge transport in the electrode
    The charge transport in the solid electron conductor materials is calculated in :func:`phi_s_equation <cideMOD.models.electrochemical.equations.phi_s_equation>` function.

    .. math::

        \begin{gathered}
            - \hat{\nabla} \left( \sigma_{eff} \hat{\nabla} \varphi_s \right) = - \sum_{i=0}^{n_{mat}} a_i j_{i}
            \quad ; \quad
            \sigma_{eff} \hat{\nabla} \varphi_s \Big|_{tab} = I_{app}
        \end{gathered}

    In the current colectors, a similar equation is used, but in this case, there is no exchage with the electrolyte, therefore the right hand side term equals zero.

* Mass transport in the active material (pseudodimension)
    The mass transport in the active material is calculated in the :class:`SpectralLegendreModel <cideMOD.models.particle_models.implicit_coupling.SpectralLegendreModel>` class using Legendre polynomials.

    .. math::

        \begin{gathered}
            \frac{\partial c_s}{\partial t} =
            \hat{\nabla} \left( D_s^{eff} \hat{\nabla} c_s \right)
            \quad ; \quad
            - D_s^{eff} \hat{\nabla} c_s \Bigg|_{r=R_p} = \frac{j_{i}}{F}
        \end{gathered}

* Exchange between the electrolyte and the electrode by lithium intercalation
    The intercalation exchange current between the electrolyte and the active materials is calculated in :func:`j_int <cideMOD.models.electrochemical.equations.j_Li_equation>` function.

    .. math::

        \begin{gathered}
            j_i = F k_0 c_e^\alpha c_s^{1-\alpha} (1-c_s)^\alpha \left(e^{\frac{-\alpha F}{RT} \eta }-e^{\frac{(1-\alpha) F}{RT} \eta} \right)
        \end{gathered}

* Overpotential
    The overpotential at each part of the electrode is calculated in :func:`overpotential <cideMOD.models.electrochemical.equations.overpotential>` function

    .. math::

        \begin{gathered}
            \eta = \varphi_s - \varphi_e - U_{eq}(c_s^{surf})
        \end{gathered}

.. rubric:: Thermal Model

* Energy conservation:
    The heat transfer across the cell is computed in :func:`T_equation <cideMOD.models.thermal.equations.T_equation>` function.

    .. math::

        \begin{gathered}
            \rho c_p \frac{\partial T}{\partial t} =
            \hat{\nabla} \left( \lambda_{eff} \hat{\nabla} T \right) + q
            \quad ; \quad
            - \lambda_{eff} \hat{\nabla} T \Bigg|_{\Gamma}= h (T-T_{ext})
        \end{gathered}

* Heat generation:
    Several heat sources have been considered:
    
    .. math::

        \begin{gathered}
            q = q_{ohm}+q_{rev}+q_{irr}
        \end{gathered}
    
    * Ohmic heat source
        This corresponds to the heat generated by the transport of charge within the cell. It is calculated in :func:`solid_ohmic_heat_equation <cideMOD.models.thermal.equations.solid_ohmic_heat_equation>` function:

        .. math::

            \begin{gathered}
                q_{ohm} =  (1-\varepsilon) q_{solid} + \varepsilon q_{liquid} \\
                q_{solid} =  \sigma_{eff} \hat{\nabla} \varphi_s \hat{\nabla} \varphi_e \\
                q_{liquid} = \kappa_{eff} \hat{\nabla} \varphi_e \hat{\nabla} \varphi_e - 2 \kappa_{eff} \frac{RT}{F} (1-t_0^+) \left(1+\frac{\partial \ln{f_{\pm}}}{\partial \ln{c_e}}\right) \frac{\hat{\nabla} c_e}{c_e} \hat{\nabla} \varphi_e
            \end{gathered}

    * Reversible reaction heat source
        The reversible heat caused by the reaction is proportional to the entropy change, that is approximated with the variation of Open Circuit potential. It is calculated in :func:`reaction_reversible_heat <cideMOD.models.thermal.equations.reaction_reversible_heat>` function

        .. math::

            \begin{gathered}
                q_{rev} =  \sum_{i=0}^{n_{mat}} a_i j_{i} T \frac{\partial U_i(c_s)}{\partial T}
            \end{gathered}

    * Irreversible polarization heat source
        This represents the irreversible heating due to the polarization heat generated by the exchange current at the electrolyte-electrode interface. It is calculated in :func:`reaction_irreversible_heat <cideMOD.models.thermal.equations.reaction_irreversible_heat>` function

        .. math::

            \begin{gathered}
                q_{rev} =  \sum_{i=0}^{n_{mat}} a_i j_{i} \eta
            \end{gathered}

.. rubric:: Degradation Models

* SEI formation side reaction
    This model is implemented inside the :class:`SEI <cideMOD.models.degradation.equations.SEI>` class.
    The model considers that the SEI is originated by the electrochemical reaction between EC solvent molecule, 2 lithium ions and 2 electrons at the electrode surface:

    .. math::

            \begin{gathered}
                EC + 2 Li^+ + 2 e^- \rightarrow V_{SEI}
            \end{gathered}
    
    Therefore the rection equation reads:

    .. math::

            \begin{gathered}
                j_{SEI} = F k_{SEI} c_{EC} c_s e^{\frac{-\beta F}{RT}(\eta - (U_{SEI} - U_{eq}))}
            \end{gathered}

    where the concentration of EC solvent at the SEI must be modelled according to the transport equation:

    .. math::

            \begin{gathered}
                \frac{\partial c_{EC}}{\partial t} = \nabla \left( D_{EC} \nabla c_{EC} - \frac{ \partial \delta_{SEI}}{\partial t} c_{EC} \right)
            \end{gathered}

    with the following boundary conditions:

    .. math::

            \begin{gathered}
                \left( D_{EC} \nabla c_{EC} - \frac{ \partial \delta_{SEI}}{\partial t} c_{EC} \right) \Bigg|_{r_{SEI}=R_s} = \frac{j_{SEI}}{F}
                \quad ; \quad
                c_{EC} \big|_{r_{SEI}=R_s+\delta_{SEI}} = c_{EC}^0
            \end{gathered}

    The SEI growth can be calculated from the reaction rate and SEI components properties:

    .. math::

            \begin{gathered}
                \frac{\partial \delta_{SEI}}{\partial t} = - \frac{M_{SEI}}{2 F \rho_{SEI}} j_{SEI}
            \end{gathered}

    The total exchange current therefore has two components:

    .. math::

            \begin{gathered}
                j_{tot} = j_{int} + j_{SEI}
            \end{gathered}

    And the overpotential has now an additional component corresponding to the voltage drop caused by SEI resistance:

    .. math::

            \begin{gathered}
                \eta = \varphi_s - \varphi_e - U_{eq}(c_s) - \frac{\delta_{SEI}}{\kappa_{SEI}} j_{tot} 
            \end{gathered}

    